<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>You Are The Setting Sun</title>
	<link rel="stylesheet" href="/css/bootstrap.css">

	<style>
		.container {
			width: 300px;
		}
		.close {
			color: #e04545;
]		}
		.message {
=		}
	</style>
</head>
<body>
	
	<div class="container">
		<div class="list-group" v-cloak>
			<div v-for="message in messages" class="list-group-item">
				<span @click="removeMessage(message)" class="close glyphicon glyphicon-remove"></span>
				<span class="message">{{ message.message }}</span>
			</div>
		</div>

		<form @submit.prevent="sendMessage()" class="form-inline">
			<div class="row">
				<div class="form-group col-sm-12">
					<div class="input-group col-sm-12">

						<input  type="text" v-model="newMessage" class="form-control" placeholder="What now?">
						<div @click.prevent="sendMessage()" class="input-group-addon bg-primary">Send</div>

					</div>
				</div>
			</div>
		</form>
	</div>

	
	<script src="/socket.io/socket.io.js"></script>
	<script src="/js/vue.js"></script>
	<script>
		var vue = new Vue({
			el: 'body',

			data: {
				socket: null,
				newMessage: '',
				messages: [],
			},

			ready: function() {
				this.socket = io.connect('localhost:8080');
				this.socket.on('connected', function(data) {
					this.messages = data.messages;
				}.bind(this));

				this.registerSocketEvents();
			},

			methods: {
				sendMessage: function() {
					this.socket.emit('new-message', {message: this.newMessage});
				},

				removeMessage: function(message) {
					this.socket.emit('remove-message', message);
				},

				registerSocketEvents: function() {
					this.socket.on('message-saved', function (message) {
						this.messages.push(message);
						this.newMessage = '';
					}.bind(this));

					this.socket.on('message-removed', function(removedMessage) {
						var message = this.messages.find(function(message) {
							return message._id == removedMessage._id;
						});
						this.messages.$remove(message);
					}.bind(this));
				}
			}
		});
	</script>
	
</body>
</html>